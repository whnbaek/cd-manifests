# Configure SGS runtime handler in containerd
# The sgs-runc-wrapper intercepts container creation and delegates to nvidia-container-runtime
machine:
  files:
    - path: /etc/cri/conf.d/30-sgs-runtime.part
      op: create
      content: |
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.sgs]
          runtime_type = "io.containerd.runc.v2"
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.sgs.options]
          BinaryName = "/usr/local/bin/sgs-runc-wrapper"
          SystemdCgroup = true
        [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.sgs.options.Env]
          SGS_RUNC_PATH = "/usr/bin/nvidia-container-runtime"
